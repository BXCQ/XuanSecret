# 更新日志

本文档记录了 XuanSecret 插件的所有版本更新内容。

## [1.2.10] - 2025-08-16 🆕

### 🐛 重要修复
- **智能内容识别**：自动判断内容是 HTML 还是 Markdown，避免对已解析的 HTML 进行二次 Markdown 解析
- **代码块格式保护**：移除 CSS 中对代码块的强制样式覆盖，保持主题原有的代码块格式
- **解析逻辑优化**：已评论用户直接移除标签保留内部 HTML，未评论用户智能处理预览内容
- **Ajax 处理改进**：根据内容类型智能选择输出方式，避免重复解析导致的格式错误

## [1.2.9] - 2025-08-16

### 📋 技术改进
- **样式隔离**：插件样式不再影响原生 Markdown 代码块的显示效果
- **HTML 结构简化**：减少不必要的 HTML 包装，保持内容的原始结构
- **主题兼容性**：确保与各种主题的代码高亮插件完美配合

## [1.2.8] - 2025-08-16

### 🔧 核心优化
- **钩子机制调整**：回到 contentEx 钩子，智能处理已解析的 HTML 内容
- **双重解析问题修复**：避免对代码块进行重复的 Markdown 解析
- **格式保护增强**：确保代码块在解锁后保持原始格式

## [1.2.7] - 2025-08-16

### 🛠️ 重大修复
- **调试功能增强**：新增 URL 参数 `xuansecret_test_uncommented=1` 支持临时测试
- **兼容性改进**：优化 Cookie 设置机制，解决不同服务器环境的兼容性问题
- **错误处理**：增强异常捕获和错误处理逻辑，提高插件稳定性

## [1.2.6] - 2025-08-16

### 🔒 安全机制完善
- **三重检测验证**：完善 Cookie、localStorage 和数据库三重检测机制
- **防绕过加强**：数据库检测确保评论状态的真实性和持久性
- **跨设备同步**：基于服务器端验证，已评论用户永不丢失权限

## [1.2.5] - 2025-06-21

### 🔧 关键修复
- **Cookie 机制改进**：重写 Cookie 设置逻辑，解决在某些环境下不生效的问题
- **命名规范优化**：使用更简单直观的 Cookie 命名规则，提高系统兼容性
- **向后兼容支持**：同时支持新旧两种 Cookie 命名方式，确保平滑升级

## [1.2.4] - 2025-06-21

### 🔍 重要修复
- **作用域隔离**：修复评论状态跨文章保持的问题，确保每篇文章独立判断
- **ID 检测增强**：改进文章 ID 获取逻辑，支持多种 URL 结构和参数格式
- **存储优化**：移除全局 Cookie 标记，改用文章特定的标识符

## [1.2.3] - 2025-06-21

### 💡 重大重构
- **JavaScript 重写**：彻底重构前端 JavaScript 代码，解决游客评论后内容不显示的核心问题
- **检测逻辑优化**：增强 Cookie 检测机制，支持多种浏览器环境和安全设置
- **调试系统**：引入调试模式，支持 Alt+S 快捷键和 URL 参数调试

## [1.2.2] - 2025-06-21

### 🔧 兼容性修复
- **CSS 样式冲突**：解决部分主题下 CSS 样式冲突问题
- **代码优化**：精简 JavaScript 代码，提升执行效率

## [1.2.1] - 2025-06-21

### 🛡️ 安全加固
- **评论验证机制增强**：提高评论验证的安全性
- **错误处理改进**：完善异常捕获和错误提示机制

## [1.2.0] - 2025-05-31

### 🎨 重大更新
- **编辑器集成**：新增快捷插入按钮功能
- **界面优化**：全新的现代化 UI 设计
- **响应式支持**：完美适配移动端设备

## [1.1.0] - 2025-04-15

### ✨ 功能扩展
- **预览功能**：支持隐藏内容预览显示
- **配置扩展**：增加更多个性化配置选项
- **性能优化**：数据库查询优化，提升响应速度

## [1.0.0] - 2025-03-01

### 🎉 首次发布
- **核心功能**：基础的内容隐藏和评论解锁机制
- **安全机制**：三重检测验证体系
- **基础界面**：简洁的用户交互界面

---

## 版本说明

### 版本号规范
- 主版本号：重大功能更新或架构变更
- 次版本号：新功能添加或重要修复
- 修订版本号：小修复和优化

### 更新类型标识
- 🎉 **首次发布**
- ✨ **新功能**
- 🐛 **修复问题**
- 🔧 **技术优化**
- 🛡️ **安全更新**
- 📋 **文档更新**
- 🎨 **界面改进**
- 🔒 **安全加固** 